# Checkout微服务系统测试计划

## 1. 项目概述

### 1.1 项目背景
Checkout微服务是电商平台的核心服务之一，负责处理用户购物车结算功能，计算商品总金额并返回结算结果。

### 1.2 测试目标
- 验证Checkout微服务的功能正确性
- 确保系统能够处理各种边界情况和异常场景
- 验证系统的性能和稳定性
- 确保API接口符合设计规范

### 1.3 技术栈
- **后端框架**: Flask 2.0+
- **测试框架**: Pytest 7.0+
- **HTTP客户端**: Requests
- **编程语言**: Python 3.8+

## 2. 测试范围

### 2.1 功能测试
- ✓ 正常结算功能
- ✓ 空购物车处理
- ✓ 单个商品结算
- ✓ 多商品结算
- ✓ 数量计算正确性

### 2.2 异常测试
- ✓ 无效价格处理（负数价格）
- ✓ 无效数量处理（负数、非整数）
- ✓ 无效请求格式
- ✓ 数据类型验证

### 2.3 边界测试
- ✓ 浮点数精度处理
- ✓ 大额订单处理
- ✓ 零价格商品
- ✓ 零数量商品

## 3. 测试环境

### 3.1 环境配置
```bash
# 安装依赖
pip install flask pytest requests

# 运行应用
python app/app.py

# 运行测试
pytest tests/test_checkout.py -v
```

### 3.2 测试数据
- **基础URL**: http://localhost:5000
- **API端点**: /checkout (POST)
- **请求方法**: POST
- **请求格式**: JSON

## 4. 测试用例设计

### 4.1 正常场景测试

#### TC-001: 正常结算场景
**测试步骤**:
1. 发送包含多个商品的结算请求
2. 验证响应状态码为200
3. 验证总金额计算正确性

**请求数据**:
```json
{
    "items": [
        {"price": 10.99, "quantity": 2},
        {"price": 5.99, "quantity": 1},
        {"price": 3.50, "quantity": 4}
    ]
}
```

**预期结果**:
- 状态码: 200 OK
- 总金额: 41.97
- 状态: "ok"

### 4.2 异常场景测试

#### TC-002: 空购物车场景
**测试步骤**:
1. 发送空购物车结算请求
2. 验证响应状态码为400
3. 验证错误信息正确性

**请求数据**:
```json
{
    "items": []
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 错误信息: "empty cart"

#### TC-003: 无效价格场景
**测试步骤**:
1. 发送包含负数价格的请求
2. 验证系统能够正确处理

**请求数据**:
```json
{
    "items": [{"price": -10.00, "quantity": 1}]
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 错误信息: "price must be a non-negative number"

### 4.3 边界场景测试

#### TC-004: 浮点数精度场景
**测试步骤**:
1. 发送包含可能产生精度问题的价格
2. 验证计算结果的精度

**请求数据**:
```json
{
    "items": [
        {"price": 0.1, "quantity": 3},
        {"price": 0.2, "quantity": 2}
    ]
}
```

**预期结果**:
- 状态码: 200 OK
- 总金额: 0.70

## 5. 测试执行计划

### 5.1 测试执行顺序
1. 单元测试 → 验证各个组件功能
2. 集成测试 → 验证服务间交互
3. 系统测试 → 验证整个系统功能
4. 回归测试 → 验证修复后的功能

### 5.2 测试执行频率
- **开发阶段**: 每次代码提交后执行
- **集成阶段**: 每日构建后执行
- **发布前**: 完整测试套件执行

## 6. 风险评估

### 6.1 技术风险
- **浮点数精度问题**: 价格计算可能存在精度误差
- **性能瓶颈**: 大额订单可能导致性能问题
- **数据验证**: 缺乏严格的数据验证可能导致系统异常

### 6.2 缓解措施
- 使用decimal模块处理精确计算
- 实现请求限流和负载均衡
- 加强输入数据验证和错误处理

## 7. 测试交付物

### 7.1 测试文档
- ✓ 系统测试计划 (本文档)
- ✓ 测试用例文档
- ✓ 测试报告模板

### 7.2 测试代码
- ✓ 自动化测试脚本
- ✓ 测试数据文件
- ✓ 测试配置文件

### 7.3 测试报告
- 测试执行结果
- 缺陷报告
- 性能测试报告

## 8. 测试通过标准

### 8.1 功能测试通过标准
- 所有功能测试用例通过率达到100%
- 所有边界测试用例通过率达到100%
- 所有异常测试用例通过率达到100%

### 8.2 性能测试通过标准
- 响应时间 < 100ms
- 并发用户数 > 100
- 错误率 < 0.1%

## 9. 附录

### 9.1 API接口规范
```
POST /checkout
Content-Type: application/json

请求参数:
{
    "items": [
        {
            "price": number,      // 商品价格 (非负数)
            "quantity": integer   // 商品数量 (非负整数)
        }
    ]
}

成功响应:
{
    "total": number,    // 总金额
    "status": "ok"      // 状态
}

错误响应:
{
    "error": string     // 错误信息
}
```

### 9.2 测试命令参考
```bash
# 运行所有测试
pytest tests/test_checkout.py -v

# 运行指定测试
pytest tests/test_checkout.py::TestCheckoutService::test_checkout_normal_case -v

# 生成测试报告
pytest tests/test_checkout.py --html=report.html

# 运行性能测试
pytest tests/test_checkout.py -k "large_order" -v
```

### 9.3 常见问题解决
```bash
# 端口被占用
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# 依赖包安装问题
pip install --upgrade pip
pip install -r requirements.txt
```

---

**测试计划版本**: 1.0  
**创建日期**: 2025-11-19  
**测试负责人**: [姓名]  
**审核人**: [姓名]